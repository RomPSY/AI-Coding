(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))d(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const s of c.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&d(s)}).observe(document,{childList:!0,subtree:!0});function i(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function d(n){if(n.ep)return;n.ep=!0;const c=i(n);fetch(n.href,c)}})();let o=[];const m=document.getElementById("taskInput"),h=document.getElementById("addTaskBtn"),b=document.getElementById("prioritySelect"),u=document.getElementById("taskList"),p=document.getElementById("pendingCount"),f=document.getElementById("completedCount"),E=document.getElementById("clearCompletedBtn"),S=document.getElementById("clearAllBtn"),y=document.getElementById("emptyState");function v(){$(),r(),l(),h.addEventListener("click",g),m.addEventListener("keypress",function(e){e.key==="Enter"&&g()}),E.addEventListener("click",B),S.addEventListener("click",I)}function g(){const e=m.value.trim();if(e){const t={id:Date.now().toString(),text:e,completed:!1,priority:b.value};o.push(t),a(),r(),l(),m.value=""}}function r(){u.innerHTML="",o.forEach(e=>{const t=document.createElement("li");t.className=`task-item priority-${e.priority}`,t.innerHTML=`
            <input type="checkbox" class="task-checkbox" ${e.completed?"checked":""} data-id="${e.id}">
            <span class="task-text ${e.completed?"completed":""}">${e.text}</span>
            <button class="edit-btn" data-id="${e.id}">编辑</button>
            <button class="delete-btn" data-id="${e.id}">删除</button>
        `,u.appendChild(t)}),q(),k()}function k(){document.querySelectorAll(".task-checkbox").forEach(e=>{e.addEventListener("change",function(){const t=this.dataset.id;L(t)})}),document.querySelectorAll(".edit-btn").forEach(e=>{e.addEventListener("click",function(){const t=this.dataset.id;x(t)})}),document.querySelectorAll(".delete-btn").forEach(e=>{e.addEventListener("click",function(){const t=this.dataset.id;T(t)})})}function L(e){o=o.map(t=>t.id===e?{...t,completed:!t.completed}:t),a(),r(),l()}function T(e){o=o.filter(t=>t.id!==e),a(),r(),l()}function l(){const e=o.filter(i=>i.completed).length,t=o.length-e;p.textContent="未完成",p.setAttribute("data-count",t),f.textContent="已完成",f.setAttribute("data-count",e)}function a(){localStorage.setItem("tasks",JSON.stringify(o))}function $(){const e=localStorage.getItem("tasks");e&&(o=JSON.parse(e))}function x(e){const t=o.find(d=>d.id===e);if(!t)return;const i=document.querySelector(`.task-item[data-id="${e}"]`)||Array.from(document.querySelectorAll(".task-item")).find(d=>d.querySelector('[data-id="'+e+'"]'));if(i){const d=i.innerHTML;i.innerHTML=`
            <input type="checkbox" class="task-checkbox" ${t.completed?"checked":""} data-id="${t.id}" disabled>
            <input type="text" class="edit-mode" value="${t.text}" data-id="${t.id}">
            <select class="priority-select-edit" data-id="${t.id}">
                <option value="medium" ${t.priority==="medium"?"selected":""}>中</option>
                <option value="high" ${t.priority==="high"?"selected":""}>高</option>
                <option value="low" ${t.priority==="low"?"selected":""}>低</option>
            </select>
            <button class="save-btn" data-id="${t.id}">保存</button>
            <button class="cancel-btn" data-id="${t.id}">取消</button>
        `,i.querySelector(".save-btn").addEventListener("click",function(){const n=i.querySelector(".edit-mode").value.trim(),c=i.querySelector(".priority-select-edit").value;n&&(o=o.map(s=>s.id===e?{...s,text:n,priority:c}:s),a(),r(),l())}),i.querySelector(".cancel-btn").addEventListener("click",function(){i.innerHTML=d,k()}),i.querySelector(".edit-mode").focus()}}function B(){o=o.filter(e=>!e.completed),a(),r(),l()}function I(){confirm("确定要清空所有任务吗？此操作不可恢复。")&&(o=[],a(),r(),l())}function q(){o.length===0?(y.style.display="block",u.style.display="none",document.querySelector(".stats").style.display="none"):(y.style.display="none",u.style.display="block",document.querySelector(".stats").style.display="flex")}v();
